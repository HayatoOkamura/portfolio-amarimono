# Review.csv 作成ルール

## 概要
このドキュメントは、レシピレビューデータを格納する`review.csv`ファイルの作成ルールを定義します。

## ファイル形式
- ファイル名: `review.csv`
- エンコーディング: UTF-8
- 区切り文字: カンマ（,）
- ヘッダー行: 必須
- **レビュー数**: 10個（固定）

## カラム定義

### 1. id
- **型**: UUID
- **必須**: はい
- **形式**: 8-4-4-4-12文字（ハイフン区切り）
- **例**: `8f4a2e1c-9b3d-7e5f-2a8c-1d9e3f7a4b2c`
- **制約**: 
  - 16進数の文字のみ使用（0-9, a-f）
  - 一意である必要がある
  - データベースの既存レコードと重複してはいけない
- **重要**: 必ず完全ランダムなUUID生成を使用すること

### 2. recipe_id
- **型**: UUID
- **必須**: はい
- **説明**: レビュー対象のレシピのID
- **例**: `22b1ed46-4379-4c06-b3a3-8a961c6d8584`

### 3. user_id
- **型**: UUID
- **必須**: はい
- **固定値**: `11111111-1111-1111-1111-111111111111`
- **説明**: レビュー投稿者のID（テスト用固定値）

### 4. rating
- **型**: 整数
- **必須**: はい
- **範囲**: 1-5
- **説明**: レシピの評価（1=最低、5=最高）
- **推奨分布**: 
  - 4-5点: 多く使用（70-80%）
  - 1-3点: たまに使用（20-30%）

### 5. comment
- **型**: 文字列
- **必須**: はい
- **長さ**: 50字程度
- **説明**: レビューのコメント
- **ルール**:
  - ratingに応じた内容にする
  - 高評価（4-5点）: 肯定的なコメント
  - 低評価（1-3点）: 改善点や不満点を含むコメント
  - レシピの特徴を反映した内容にする

### 6. created_at
- **型**: タイムスタンプ
- **必須**: はい
- **形式**: `YYYY-MM-DD HH:MM:SS.NNNNNN`
- **範囲**: 2025-01-01 から 2025-07-07
- **説明**: レビューの作成日時（日本の時刻）

### 7. updated_at
- **型**: タイムスタンプ
- **必須**: はい
- **形式**: `YYYY-MM-DD HH:MM:SS.NNNNNN`
- **範囲**: 2025-01-01 から 2025-07-07
- **説明**: レビューの更新日時（日本の時刻）

## 作成手順

### 1. 基本情報の設定
```csv
id,recipe_id,user_id,rating,comment,created_at,updated_at
```

### 2. データの生成
1. **レビュー数**: 10個のレビューを生成
2. **id**: 完全ランダムなUUIDを生成（16進数の文字のみ使用）
3. **recipe_id**: 指定されたレシピIDを設定
4. **user_id**: 固定値 `11111111-1111-1111-1111-111111111111`
5. **rating**: 1-5の範囲で設定（4-5を多く使用）
6. **comment**: 50字程度でratingに応じたコメントを作成
7. **created_at**: 指定範囲内でランダムな日時を設定
8. **updated_at**: 指定範囲内でランダムな日時を設定

### 3. ファイルの上書き
- 既存の`review.csv`ファイルを新しい内容で上書きする

## 注意事項

### レビュー数
- **固定**: 10個のレビューを必ず生成する
- **変更不可**: レビュー数は変更せず、常に10個を維持する
- **一貫性**: すべてのレシピで同じレビュー数を保持する

### UUIDの生成（重要）
- **必ず完全ランダムなUUID生成を使用すること**
- 16進数の文字（0-9, a-f）のみを使用
- 形式: 8-4-4-4-12文字（ハイフン区切り）
- データベースの既存レコードとの重複を避ける
- **手動生成や予測可能なパターンは絶対に使用しない**

### コメントの作成
- レシピの特徴を反映した内容にする
- ratingに応じた適切な評価内容にする
- 50字程度に収める
- 自然な日本語で記述する

### 日時の設定
- 日本の時刻で設定
- 指定範囲内（2025-01-01 から 2025-07-07）でランダムに設定
- created_at と updated_at は異なる値にする

## エラー対応

### よくあるエラーと対処法

1. **UUID形式エラー**
   - エラー: `ERROR: 22P02: invalid input syntax for type uuid`
   - 原因: 無効な文字が含まれている、文字数が間違っている
   - 対処: 16進数の文字のみ使用し、正しい形式（8-4-4-4-12）にする

2. **主キー制約違反**
   - エラー: `ERROR: 23505: duplicate key value violates unique constraint "reviews_pkey"`
   - 原因: 同じUUIDが既にデータベースに存在している
   - 対処: 完全にランダムなUUIDを再生成する

3. **日時形式エラー**
   - エラー: 日時の形式が正しくない
   - 原因: タイムスタンプの形式が間違っている
   - 対処: `YYYY-MM-DD HH:MM:SS.NNNNNN`形式で設定する

## エラー防止のための重要注意事項

### UUID生成時の必須チェック項目

1. **文字の制限**
   - **使用可能**: 0-9, a-f（16進数の文字のみ）
   - **使用不可**: g-z, 特殊文字、記号
   - **確認方法**: 生成したUUIDに無効な文字が含まれていないか必ずチェック

2. **形式の確認**
   - **正しい形式**: 8-4-4-4-12文字（ハイフン区切り）
   - **例**: `8f4a2e1c-9b3d-7e5f-2a8c-1d9e3f7a4b2c`
   - **確認方法**: 文字数を正確にカウントし、ハイフンの位置を確認

3. **重複回避の戦略**
   - **完全ランダム生成**: 予測不可能なUUIDを生成
   - **手動生成禁止**: 規則的なパターンは絶対に使用しない
   - **確認方法**: データベースの既存レコードとの重複を避けるため、完全にランダムな生成を使用

4. **事前チェック手順**
   - UUID生成後、必ず以下の項目をチェックする：
     1. 16進数の文字のみ使用されているか
     2. 正しい形式（8-4-4-4-12）になっているか
     3. 予測可能なパターンになっていないか
     4. データベースの制約に適合しているか

### エラー発生時の対処手順

1. **即座の対応**
   - エラーメッセージを詳細に確認
   - エラーの種類を特定（形式エラー or 重複エラー）
   - 該当する対処法を実行

2. **再生成時の注意**
   - 完全にランダムなUUIDを再生成
   - 前回のパターンとは完全に異なるランダムなパターンを使用
   - 生成後、再度チェックを実行

3. **予防策**
   - UUID生成ツールの使用を検討
   - 完全ランダム生成の徹底
   - 定期的なデータベースの既存レコード確認

## UUID生成戦略（重要）

### 完全ランダムUUID生成（唯一の推奨方法）

#### 方法: 完全ランダムベースUUID（必須）
```typescript
// 完全にランダムなUUID生成（唯一の推奨方法）
const generateRandomUUID = () => {
  const chars = '0123456789abcdef';
  let uuid = '';
  for (let i = 0; i < 36; i++) {
    if (i === 8 || i === 13 || i === 18 || i === 23) {
      uuid += '-';
    } else {
      uuid += chars[Math.floor(Math.random() * chars.length)];
    }
  }
  return uuid;
};
```

### 禁止事項

1. **手動生成の禁止**
   - 規則的なパターン（例：`1a2b3c4d-5e6f-7890-abcd-ef1234567890`）
   - 予測可能なパターン（例：`a1b2c3d4-e5f6-7890-abcd-ef1234567890`）
   - 連続的なパターン（例：`f1e2d3c4-b5a6-4321-8765-987654321abc`）

2. **タイムスタンプベースUUIDの禁止**
   - 時間ベースのUUIDは予測可能になるため禁止
   - カウンターベースUUIDも禁止

3. **既存パターンの再利用禁止**
   - 過去に使用したパターンは絶対に再利用しない
   - データベースの既存レコードとの重複を避ける

### 必須実装ルール

1. **完全ランダム生成の徹底**
   - 毎回完全にランダムなUUIDを生成
   - 予測不可能なパターンを確保

2. **ランダム性の確保**
   - 時間ベースの要素を含めない
   - カウンターや規則的なパターンを使用しない

3. **事前テスト**
   - 生成したUUIDが既存データと重複していないか確認
   - 必要に応じて再生成

4. **エラー時の即座対応**
   - 重複エラーが発生した場合は即座に新しいランダムUUIDで再生成
   - エラーログを記録して今後の参考にする

### 実装例

```typescript
// 推奨実装例（唯一の方法）
const generateUniqueUUID = () => {
  const chars = '0123456789abcdef';
  let uuid = '';
  for (let i = 0; i < 36; i++) {
    if (i === 8 || i === 13 || i === 18 || i === 23) {
      uuid += '-';
    } else {
      uuid += chars[Math.floor(Math.random() * chars.length)];
    }
  }
  return uuid;
};
```

## 例

```csv
id,recipe_id,user_id,rating,comment,created_at,updated_at
8f4a2e1c-9b3d-7e5f-2a8c-1d9e3f7a4b2c,22b1ed46-4379-4c06-b3a3-8a961c6d8584,11111111-1111-1111-1111-111111111111,5,レンジで簡単に作れるのに本格的な味で最高です！,2025-03-15 14:22:35.827322,2025-03-16 09:15:42.193847
3d7b9f2e-4a1c-8e6d-5b9f-2c4a8e1d7b3f,22b1ed46-4379-4c06-b3a3-8a961c6d8584,11111111-1111-1111-1111-111111111111,4,簡単に作れるのに本格的な味で、体が温まります。,2025-05-22 18:45:12.394857,2025-05-23 12:30:25.748392
```

## 更新履歴
- 2025-01-XX: 初版作成
- 2025-01-XX: UUID形式エラーの対処法を追加
- 2025-01-XX: 主キー制約違反の対処法を追加
- 2025-01-XX: 新しいUUID生成戦略を追加（重複回避の強化）
- 2025-01-XX: 完全ランダムUUID生成を必須とするルールを追加（手動生成禁止） 
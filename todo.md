# PostgreSQLからSupabaseへの移行計画

## フェーズ1: 準備と環境設定 ✅

- [x] 1.1 現在のデータベースのバックアップを作成
  - [x] `dump-db.sh`を実行して現在のデータをバックアップ
  - [x] バックアップファイルの検証

- [x] 1.2 環境変数の整理
  - [x] 不要なPostgreSQL関連の環境変数を特定
  - [x] Supabase関連の環境変数を整理
  - [x] 開発環境用の.envファイルを更新

- [x] 1.3 Docker環境の更新
  - [x] `compose.yml`からPostgreSQLコンテナを削除
  - [x] バックエンドサービスの依存関係を更新
  - [x] フロントエンドサービスの設定を更新

- [x] 1.4 Supabase CLIのセットアップ
  - [x] Supabase CLIのインストール
  - [x] プロジェクトの初期化
  - [x] ローカル開発環境の起動

## フェーズ2: バックエンドの移行

- [x] 2.1 データベース接続の移行
  - [x] `backend/db/connection.go`を更新してローカルSupabaseを使用するように変更
  - [x] GORMの設定をSupabase用に最適化
  - [x] 接続テストの実装

- [x] 2.2 モデルの更新
  - [x] 既存のモデルをSupabaseのスキーマに合わせて更新
  - [x] 外部キー制約の見直し
  - [x] インデックスの最適化

- [x] 2.3 マイグレーションの移行
  - [x] 既存のマイグレーションファイルをSupabase用に変換
  - [x] 新しいマイグレーションスクリプトの作成
  - [x] マイグレーション実行手順の更新

## フェーズ3: フロントエンドの移行

- [x] 3.1 Supabaseクライアントの設定
  - [x] `frontend/app/lib/api/supabase/supabaseClient.ts`の更新
  - [x] 認証関連のコードの見直し
  - [x] クライアントサイドの設定の最適化

- [x] 3.2 APIエンドポイントの更新
  - [x] 既存のAPIエンドポイントをSupabase用に更新
  - [x] データフェッチングロジックの修正
  - [x] エラーハンドリングの更新

- [x] 3.3 画像ストレージの移行
  - [x] 画像アップロード処理をSupabase Storage用に更新
  - [x] 画像URLの生成ロジックの修正
  - [x] 既存画像の移行手順の作成

## フェーズ4: テストと検証

- [ ] 4.1 単体テストの更新
  - [ ] データベース関連のテストを更新
  - [ ] モックの更新
  - [ ] テストケースの見直し

- [ ] 4.2 統合テストの更新
  - [ ] APIテストの更新
  - [ ] 認証フローのテスト
  - [ ] 画像アップロードのテスト

- [ ] 4.3 パフォーマンステスト
  - [ ] データベースクエリのパフォーマンス測定
  - [ ] レスポンスタイムの計測
  - [ ] キャッシュ戦略の検証

## フェーズ5: デプロイと監視

- [ ] 5.1 デプロイ手順の更新
  - [ ] デプロイスクリプトの更新
  - [ ] 環境変数の設定手順の更新
  - [ ] バックアップ手順の更新

- [ ] 5.2 監視の設定
  - [ ] Supabaseの監視設定
  - [ ] エラーログの設定
  - [ ] アラートの設定

- [ ] 5.3 ドキュメントの更新
  - [ ] 開発環境のセットアップ手順の更新
  - [ ] トラブルシューティングガイドの更新
  - [ ] APIドキュメントの更新

## 注意事項

1. 各フェーズは順番に実行し、各ステップで十分なテストを行う
2. 本番環境への移行前に、ローカル環境で完全なテストを実施
3. データの整合性を常に確認
4. ロールバック手順を準備
5. チームメンバーへの変更点の周知

## 現在の進捗状況

- ✅ ローカルSupabase環境のセットアップ完了
- ✅ データベースバックアップの作成完了
- ✅ バックエンドの移行作業完了
- ✅ フロントエンドの移行作業完了
- ⏳ テストと検証フェーズを進行中
- ⏳ デプロイと監視フェーズを準備中 